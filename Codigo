; Por questão de tempo não conseguir implementar um contador em um display, então estou fazendo um contador, baseado em um programa 
;que tentamos fazer ontem na lista de exercícios, da seguinte forma:

;Escolhi a PORT B0 como entrada e PORT A0 como saída, dessa forma ao apertar ON o programa irá parar, ao apertar ON de novo o programa irá rodar novamente.
;As portas C, serão os contadores, em que a cada quase 1 segundo cada LED irá piscar de forma ordernada, logo será primeiro o Port C0,
;depois o port C1, port C2 até voltar novamente ao C0.

;Para simular isso, usei o keypad matrix e liguei o B0 ao 10 k e o A0 ao 1 K.

;Não consegui zerar o cronômetro
	
	
	
	
	
	
	
	ORG 0X00
	CONT EQU 0x20
	BUT EQU 0x21
	W_TEMP EQU 0x22
	STATUS_TEMP EQU 0x23
	PCLATH_TEMP EQU 0x24
	DIGA EQU 0x30
	DIGB EQU 0x31
	DIGC EQU 0x32
	DIGD EQU 0x33
    GOTO SETTINGS


    ORG 0X04

    MOVWF W_TEMP 
    SWAPF STATUS,W 
    CLRF STATUS 
    MOVWF STATUS_TEMP 
    MOVF PCLATH, W 
    MOVWF PCLATH_TEMP 
    CLRF PCLATH 

	BTFSS PORTB, 1
	GOTO NAO_ZERA
	CLRF 0X30
	CLRF 0X31
	CLRF 0X32
	CLRF 0X33
	
NAO_ZERA:

    BTFSC INTCON,INTF
    COMF BUT,F ; ATIVA A PAUSA
    BTFSS BUT,0 ; PAUSA O CRONÔMETRO SE BUT0 = 1
	GOTO NOT_YET
    CLRF TMR0


	INCF DIGA,F
	MOVLW 10
	SUBWF DIGA,W
	BTFSS STATUS,Z
	GOTO NOT_YET
	CLRF DIGA
	INCF DIGB,F
	MOVLW 10
	SUBWF DIGB,W
	BTFSS STATUS,Z
	GOTO NOT_YET
	CLRF DIGB
	INCF DIGC,F
	MOVLW 10
	SUBWF DIGC,W
	BTFSS STATUS,Z
	GOTO NOT_YET
	CLRF DIGD
	INCF DIGD,F
	MOVLW 10
	SUBWF DIGD,W
	BTFSS STATUS,Z
	GOTO NOT_YET
	CLRF DIGD

NOT_YET:


    MOVF PCLATH_TEMP, W 
    MOVWF PCLATH 
    SWAPF STATUS_TEMP,W 
    MOVWF STATUS 
    SWAPF W_TEMP,F 
    SWAPF W_TEMP,W 
    BCF INTCON,INTF ; ZERA A FLAG DE B0
    BCF INTCON,TMR0IF ; ZERA FLAG DO TIMER0
    RETFIE
    
SETTINGS:
    BSF INTCON,5  
    BSF INTCON,4  ;ATIVA O INTERRUPT PORTB0
    BSF STATUS,RP0
    BSF OPTION_REG,6  
    BCF OPTION_REG,5 ; ATIVA O TIMER0
    BCF OPTION_REG,3 ; COLOCA O PRESCALER NO TIMER0
    BSF OPTION_REG,2
    BSF OPTION_REG,1
    BCF OPTION_REG,0 ; COLOCA PRESCALER DE 1:128
    BCF STATUS,RP0 
    MOVLW TRISD
    MOVWF FSR
    CLRF INDF  ;COLOCA PORTA COMO OUTPUT
    MOVLW TRISA 
    MOVWF FSR
    CLRF INDF  ;COLOCA PORTA COMO OUTPUT
    MOVLW TRISC
    MOVWF FSR
    CLRF INDF ;COLOCA PORTC COMO OUTPUT
    BSF TRISB,0 ;COLOCA PORTB0 COMO INPUT
    BSF STATUS,C
    CLRF BUT
    MOVLW 32
    MOVWF CONT    
    BSF PORTA,0
    BSF INTCON,7 

MAIN:
    DECFSZ CONT,F
    GOTO MAIN
    MOVLW 32
    MOVWF CONT    

	MOVFW DIGA
	CALL DIG
	MOVWF PORTD
	BSF PORTA, 5
	BCF PORTA,5	
	MOVFW DIGB
	CALL DIG
	MOVWF PORTD
	BSF PORTA, 4
	BCF PORTA, 4	
	MOVFW DIGC
	CALL DIG
	MOVWF PORTD
	BSF PORTA, 3
	BCF PORTA,3	
	MOVFW DIGD
	CALL DIG
	MOVWF PORTD
	BSF PORTA, 2
	BCF PORTA,2
	GOTO MAIN		


DIG	ADDWF	PCL,F	
DIG0	RETLW 0x3F
DIG1	RETLW 0x06
DIG2	RETLW 0x5b
DIG3	RETLW 0x4F
DIG4	RETLW 0x66
DIG5	RETLW 0x6D
DIG6	RETLW 0x7D
DIG7	RETLW 0x07
DIG8	RETLW 0x7F
DIG9	RETLW 0x6F